<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head th:replace="baseJs::header"></head>
<style>
    html {
        height: 100%;
    / / 让html的高度等于屏幕
    }

    body {
        height: 100%;
        margin: 0;
    }

    .layui-form-pane .layui-form-label {
        width: 150px;
    }

    .layui-form-pane .layui-input-block {
        margin-left: 150px;
    }
</style>

<!--<div class="layui-form-item">-->

<!--<div class="layui-inline">-->
<!--<label class="layui-form-label required">逾期金额</label>-->
<!--<div class="layui-input-block">-->
<!--<input type="text" name="pastAmount" th:value="*{pastAmount}" required="" lay-verify="required"-->
<!--value="" autocomplete="off" class="layui-input" tabind="1"/>-->
<!--</div>-->
<!--</div>-->

<!--<div class="layui-inline">-->
<!--<label class="layui-form-label required">逾期本金</label>-->
<!--<div class="layui-input-block">-->
<!--<input type="text" name="pastCorpus" th:value="*{pastCorpus}" required="" lay-verify="required"-->
<!--value="" autocomplete="off" class="layui-input" tabind="3"/>-->
<!--</div>-->
<!--</div>-->

<!--<div class="layui-inline">-->
<!--<label class="layui-form-label required">逾期期数</label>-->
<!--<div class="layui-input-block">-->
<!--<input type="text" name="pastPeriod" th:value="*{pastPeriod}" required="" lay-verify="required"-->
<!--value="" autocomplete="off" class="layui-input" tabind="3"/>-->
<!--</div>-->
<!--</div>-->


<!--<div class="layui-inline">-->
<!--<label class="layui-form-label required">最后还款日期</label>-->
<!--<div class="layui-input-block">-->
<!--<input type="text" id="lastReturnDate" name="lastReturnDate"  required=""-->
<!--lay-verify="required"-->
<!--value="" autocomplete="off" class="layui-input" tabind="3"/>-->
<!--</div>-->
<!--</div>-->


<!--<div class="layui-inline">-->
<!--<label class="layui-form-label required">最后还款金额</label>-->
<!--<div class="layui-input-block">-->
<!--<input type="text" name="lastReturnAmount" th:value="*{lastReturnAmount}" required=""-->
<!--lay-verify="required"-->
<!--value="" autocomplete="off" class="layui-input" tabind="3"/>-->
<!--</div>-->
<!--</div>-->

<!--</div><div class="layui-form-item">-->

<!--<div class="layui-inline">-->
<!--<label class="layui-form-label required">逾期金额</label>-->
<!--<div class="layui-input-block">-->
<!--<input type="text" name="pastAmount" th:value="*{pastAmount}" required="" lay-verify="required"-->
<!--value="" autocomplete="off" class="layui-input" tabind="1"/>-->
<!--</div>-->
<!--</div>-->

<!--<div class="layui-inline">-->
<!--<label class="layui-form-label required">逾期本金</label>-->
<!--<div class="layui-input-block">-->
<!--<input type="text" name="pastCorpus" th:value="*{pastCorpus}" required="" lay-verify="required"-->
<!--value="" autocomplete="off" class="layui-input" tabind="3"/>-->
<!--</div>-->
<!--</div>-->

<!--<div class="layui-inline">-->
<!--<label class="layui-form-label required">逾期期数</label>-->
<!--<div class="layui-input-block">-->
<!--<input type="text" name="pastPeriod" th:value="*{pastPeriod}" required="" lay-verify="required"-->
<!--value="" autocomplete="off" class="layui-input" tabind="3"/>-->
<!--</div>-->
<!--</div>-->


<!--<div class="layui-inline">-->
<!--<label class="layui-form-label required">最后还款日期</label>-->
<!--<div class="layui-input-block">-->
<!--<input type="text" id="lastReturnDate" name="lastReturnDate"  required=""-->
<!--lay-verify="required"-->
<!--value="" autocomplete="off" class="layui-input" tabind="3"/>-->
<!--</div>-->
<!--</div>-->


<!--<div class="layui-inline">-->
<!--<label class="layui-form-label required">最后还款金额</label>-->
<!--<div class="layui-input-block">-->
<!--<input type="text" name="lastReturnAmount" th:value="*{lastReturnAmount}" required=""-->
<!--lay-verify="required"-->
<!--value="" autocomplete="off" class="layui-input" tabind="3"/>-->
<!--</div>-->
<!--</div>-->

<!--</div>-->
<body id="thisbody">
<form id="addForm" class="layui-form layui-form-pane" style="margin-top: 5px" th:object="${data}">
    <input hidden="hidden" name="schoolId" th:value="*{schoolId}"/>
    <div class="layui-form-item">
        <label class="layui-form-label required">学校名称</label>
        <div class="layui-input-block">
            <input type="text" id="schoolName" name="schoolName" th:value="*{schoolName}" autocomplete="off"
                   class="layui-input disabled-background-color"/>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label required">省</label>
        <div class="layui-input-block">
            <select id="province" name="province" lay-verify="required" lay-search="" lay-filter="selectProvince">
            </select>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label required">市</label>
        <div class="layui-input-block">
            <select id="city" name="city" lay-verify="required" lay-search="" lay-filter="selectCity">
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label required">区/县</label>
        <div class="layui-input-block">
            <select id="county" name="county" lay-verify="required" lay-search="" lay-filter="selectEvent">
            </select>

        </div>
    </div>


    <div class="layui-form-item">
        <label class="layui-form-label required">详细地址</label>
        <div class="layui-input-block">
            <input type="text" name="address" th:value="*{address}" required="" lay-verify="required"
                   placeholder="请输入详细地址" value="" autocomplete="off" th:class="'layui-input'"/>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label required">联系人</label>
        <div class="layui-input-block">
            <input type="text" name="contacts" th:value="*{contacts}" required="" lay-verify="required"
                   placeholder="请输入联系人姓名" value="" autocomplete="off" class="layui-input"/>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label required">手机号</label>
        <div class="layui-input-block">
            <input type="text" name="phone" th:value="*{phone}" required="" lay-verify="required" placeholder="请输入手机号码"
                   value="" autocomplete="off" class="layui-input"/>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">座机号</label>
        <div class="layui-input-block">
            <input type="text" name="tel" th:value="*{tel}" required="" placeholder="请输入座机号码" value=""
                   autocomplete="off" class="layui-input"/>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">官网地址</label>
        <div class="layui-input-block">
            <input type="text" name="website" th:value="*{website}" required="" placeholder="请输入官网url" value=""
                   autocomplete="off" class="layui-input"/>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label ">备注</label>
        <div class="layui-input-block">
            <input type="text" name="notes" th:value="*{notes}" required="" placeholder="请输入备注" value=""
                   autocomplete="off" class="layui-input"/>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label ">学校展示图</label>
        <div class="layui-input-block">
            <button type="button" class="layui-btn">
                <i class="layui-icon">&#xe67c;</i>请选择图片
            </button>
            <input type="text" id="schoolpic" name="schoolpic" th:value="*{schoolpic}" hidden="hidden"/>
        </div>
        <div class="layui-input-block" id="img_list">

        </div>

    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">学校简介</label>
        <div class="layui-input-block">

            <textarea class="layui-textarea" placeholder="请输入学校简介" style="display: none"
                      name="introduce" id="introduce">

             </textarea>
            <!--<div class="site-demo-button" style="margin-top: 20px;">-->
            <!--<button class="layui-btn site-demo-layedit" data-type="content">获取编辑器内容</button>-->
            <!--<button class="layui-btn site-demo-layedit" data-type="text">获取编辑器纯文本内容</button>-->
            <!--<button class="layui-btn site-demo-layedit" data-type="selection">获取编辑器选中内容</button>-->
            <!--</div>-->
        </div>
    </div>

</form>
</body>
<script th:inline="javascript">
    var data = [[${data}]];
    var index;
    layui.use(['form', 'layedit'], function () {
        form = layui.form;
        layedit = layui.layedit;
        initProvince();
        initCity(data.province);
        initCountry(data.city);
        form.on('select(selectProvince)', function (data) {
            initCity(data.value);
            form.on('select(selectCity)', function (dataChild) {
                initCountry(dataChild.value);

            });
        });


        index = layedit.build('introduce', {
            height: 180, //设置编辑器高度
            tool: [
                'strong' //加粗
                , 'italic' //斜体
                , 'underline' //下划线
                , 'del' //删除线

                , '|' //分割线

                , 'left' //左对齐
                , 'center' //居中对齐
                , 'right' //右对齐
                , 'link' //超链接
                , 'unlink' //清除链接
                , 'face' //表
            ]
        });

        if (data.introduce != null) {
            if (data.introduce != '') {
                layedit.setContent(index, data.introduce);
            }
        }
    });

    function save() {
        $.ajax({
            type: 'POST',
            url: path + 'school/update',
            data: $("#addForm").serialize(),
            async: false,
            success: function (result) {
                if (result == 1) {
                    flag = true;
                } else {
                    flag = false;
                }
            }
        });
        return flag;
    }

    function initProvince() {
        $.ajax({
            type: 'POST',
            url: path + 'common/getHtmlSelectOptionsByWhereCase',
            data: {
                tableName: "xxb_area",
                codeField: "area_code",
                nameField: "area_name",
                whereCase: "area_code like '%0000'",
                selectValue: data.province
            },
            async: false,
            success: function (result) {
                $("#province").html('<option value=""></option>' + result);
                form.render("select");
            }
        });
    }


    function initCity(pCode) {
        if(pCode==null||pCode=='')return;
        var pre = pCode.substring(0, 2);
        $.ajax({
            type: 'POST',
            url: path + 'common/getHtmlSelectOptionsByWhereCase',
            data: {
                tableName: "xxb_area",
                codeField: "area_code",
                nameField: "area_name",
                whereCase: "area_code like '%00' and area_code like '" + pre + "%' and area_code!='" + pCode + "'",
                "selectValue": data.city
            },
            async: false,
            success: function (result) {
                $("#city").html('<option value=""></option>' + result);
                form.render("select");
            }
        });
    }


    function initCountry(pCode) {
        if(pCode==null||pCode=='')return;
        var pre = pCode.substring(0, 4);
        $.ajax({
            type: 'POST',
            url: path + 'common/getHtmlSelectOptionsByWhereCase',
            data: {
                tableName: "xxb_area",
                codeField: "area_code",
                nameField: "area_name",
                whereCase: "area_code like '" + pre + "%'  and area_code!='" + pCode + "'",
                selectValue: data.county
            },
            async: false,
            success: function (result) {
                $("#county").html('<option value=""></option>' + result);
                form.render("select");
            }
        });
    }


    function yz() {
        var introduce = layedit.getContent(index).replace(/(^\s*)|(\s*$)/g, "");
        $('#introduce').val(introduce);
        if (!Verification($("#addForm")))
            return false;
        else
            return true;
    }


    layui.use(['upload', 'element', 'laydate'], function () {
        var $ = layui.jquery
            , upload = layui.upload, element = layui.element, laydate = layui.laydate;

        if (data.schoolpic != null ) {
            if( data.schoolpic != ''){
                $('#img_list').html('<img src="' + data.schoolpic + '" style="width: 60px;height: 60px"/>');
            }
        }


        var uploadInst = upload.render({
            elem: '.layui-btn'
            , url: path + 'common/myupload/img'
            , before: function (obj) {
                //预读本地文件示例，不支持ie8
                obj.preview(function (index, file, result) {
                    $('#demo1').attr('src', result); //图片链接（base64）
                });
            }
            , done: function (res) {
                //如果上传失败
                if (res.code > 0) {
                    return layer.msg('上传失败');
                }
                else {
                    //上传成功
                    if (res.flag) {
                        $('#img_list').html('<img src="' + res.url + '" style="width: 60px;height: 60px"/>');
                        $('#schoolpic').val(res.url);

                    } else {
                        return layer.msg('上传失败');
                    }

                }

            }
            , accept: 'file'
            , error: function () {
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-mini demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function () {
                    uploadInst.upload();
                });
            }
        });


    });


</script>
</html>
